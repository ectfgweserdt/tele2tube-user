name: Run Telegram to YouTube Batch Uploader

on:
  workflow_dispatch:
    inputs:
      telegram_links:
        description: 'Comma-separated Telegram links (e.g., https://t.me/c/1/10, https://t.me/c/1/11)'
        required: true
        type: string
      
jobs:
  upload:
    runs-on: ubuntu-latest
    # Added a timeout of 3 hours just in case you provide many large files
    timeout-minutes: 180 
    
    env:
      TG_API_ID: ${{ secrets.TG_API_ID }}
      TG_API_HASH: ${{ secrets.TG_API_HASH }}
      TG_SESSION_STRING: ${{ secrets.TG_SESSION_STRING }}
      YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
      YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
      YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install -r requirements.txt
        
      - name: Install FFmpeg
        run: sudo apt-get update && sudo apt-get install -y ffmpeg
        
      - name: Run Uploader Script
        # We pass the entire input string to the script
        run: python uploader_script.py "${{ github.event.inputs.telegram_links }}"
